/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed.
 *
 * This is a jQuery UI Widget
 *
 * @author Matthew Toledo
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test), hammer.js
 */
(function(d,c,a,e){var b=false;d.widget("ri.responsiveCarousel",{options:{arrowLeft:".arrow-left a",arrowRight:".arrow-right a",target:".slider-target",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,dragEvents:false,cssAnimations:Modernizr.cssanimations},internal:{left:0,targetWidth:0,unitWidth:0,targetOuterWidth:0,targetOuterHeight:0,targetParentOuterWidth:0,targetParentInnerWidth:0,targetParentOuterHeight:0,targetParentMarginLeft:0,targetBackupCopy:null,isArrowBeingClicked:false,arrowLeftVisible:true,arrowRightVisible:true,targetLeft:0,timer:null,firstMouseClick:false,prefix:null},wait:function(){var g,f=function(i,h){if("undefined"!==typeof g){c.clearTimeout(g);}g=c.setTimeout(i,h);};return{thenDo:function(i,h){f(i,h);}};},_getPrefix:function(k){var j=["Moz","Webkit","Khtml","0","ms"],i=a.createElement("div"),h=k.charAt(0).toUpperCase()+k.slice(1),g="";for(var f=j.length;f--;){if((j[f]+h) in i.style){g=(j[f]);}}if(k in i.style){g=(k);}return"-"+g.toLowerCase()+"-";},_animate:function(f,i,j,m,l){var h=this.options,g=this.internal,k=j&&typeof j==="object"?jQuery.extend({},j):{complete:l||!l&&m||jQuery.isFunction(j)&&j,duration:j,easing:l&&m||m&&!jQuery.isFunction(m)&&m};return f.each(function(){var o=d(this),p=(k.easing)?p:"ease-in-out",n=(g.prefix);if(h.cssAnimations){o.css(n+"transition","all "+j/1000+"s ease-in-out").css(i);setTimeout(function(){o.css(n+"transition","");if(d.isFunction(k.complete)){k.complete();}},j);}else{o.animate(i,j,k);}});},_setTargetWidth:function(i){var g=this.internal,h=this.options,j=d(this.element),f=d(this.element).find(h.target);g.targetWidth=f.find(h.unitElement).length*g.unitWidth;j.find(h.target).width(g.targetWidth);g.targetOuterWidth=f.outerWidth();g.targetOuterHeight=f.outerHeight();g.targetParentOuterWidth=f.parent().outerWidth();g.targetParentInnerWidth=f.parent().innerWidth();g.targetParentOuterHeight=f.parent().outerHeight();g.targetParentMarginLeft=parseInt(f.parents().css("marginLeft"),10);},_setArrowVisibility:function(){var n=this.options,h=this.internal,g=d(this.element).find(n.target),f=g.position().left,m=h.targetOuterWidth+f,j=d(this.element).find(n.arrowLeft),l=d(this.element).find(n.arrowRight),k=0,i=h.targetParentOuterWidth;if(m<=i){l.hide();if(h.isArrowBeingClicked===true){this._clearInterval();}h.arrowRightVisible=h.isArrowBeingClicked=false;}else{if(false===h.arrowRightVisible){l.show();h.arrowRightVisible=true;}}if(f>=k){j.hide();if(h.isArrowBeingClicked===true){this._clearInterval();}h.arrowLeftVisible=h.isArrowBeingClicked=false;}else{if(false===h.arrowLeftVisible){j.show();h.arrowLeftVisible=true;}}},_clearInterval:function(){var g=this.internal,h=this.options,f=d(this.element).find(h.target);if("number"===typeof g.timer){g.isArrowBeingClicked=false;c.clearInterval(g.timer);}if(false===b){b=true;this._animate(f,{left:this.computeAdjust(f)},400,function(){b=false;});}},_setArrowEvents:function(){var o,k=this,p=this.options,i=this.internal,h=d(this.element).find(p.target),j=d(this.element).find(p.arrowLeft),n=d(this.element).find(p.arrowRight),m="",g="";var l=function(q){var r=q.position().left;return;};var f=function(s){var q=h.position().left,t=i.targetParentMarginLeft,r;if(b===true){return;}if("left"===s){if(p.dragEvents===true){r=q-t+10;}else{r=q-t+i.unitWidth;}}else{if("right"===s){if(p.dragEvents===true){r=q-t-10;}else{r=q-t-i.unitWidth;}}else{throw"unknown direction";}}if(p.dragEvents===true){h.css({left:r});k._setArrowVisibility();l(h);}else{b=true;k._animate(h,{left:r},400,function(){k._setArrowVisibility();b=false;l(h);});}};j.on("click.simpslide",function(q){q.preventDefault();});n.on("click.simpslide",function(q){q.preventDefault();});if(p.dragEvents===true){m="mousedown.simpslide touchstart.simpslide";g="mouseup.simpslide touchend.simpslide";}else{m="mousedown.simpslide";g="mouseup.simpslide";}j.on(m,function(q){q.preventDefault();if(b===false){i.isArrowBeingClicked=i.firstMouseClick=true;i.timer=c.setInterval(function(){f("left");},10);}});n.on(m,function(q){if(b===false){i.isArrowBeingClicked=i.firstMouseClick=true;i.timer=c.setInterval(function(){f("right");},10);}});d(this.element).on(g,function(){if(i.isArrowBeingClicked===true){k._clearInterval();}});},_setUnitWidth:function(){var m,k=this,j=this.internal,o=this.options,f=d(this.element).find(o.target),n=d(this.element),g=f.find(o.unitElement).eq(0),i=new this.wait();var l=function(){j.unitWidth=g.outerWidth();};var h=0;if(o.unitWidth==="inherit"){l();f.find("img").on("load.simpslide",function(){l();k._setTargetWidth("inherit");k._setArrowVisibility();if(d.isFunction(o.onRedraw)){o.onRedraw(n,j,o);}});}else{if(o.unitWidth==="compute"){l();if(d.isFunction(o.responsiveUnitSize)){m=o.responsiveUnitSize(n,j,o);f.find(o.unitElement).css("width",m-h);l();}if(d.isFunction(o.onRedraw)){o.onRedraw(n,j,o);}f.find("img").on("load",function(){if(d.isFunction(o.responsiveUnitSize)){m=o.responsiveUnitSize(n,j,o);f.find(o.unitElement).css("width",m-h);}l();k._setTargetWidth("compute");k._setArrowVisibility();if(d.isFunction(o.onRedraw)){o.onRedraw(n,j,o);}});d(c).on("resize.simpslide",function(){i.thenDo(function(){var p;if(d.isFunction(o.responsiveUnitSize)){m=o.responsiveUnitSize(n,j,o);f.find(o.unitElement).css("width",m-h);}l();k._setTargetWidth("compute (window resize)");p=k.computeAdjust(f);f.css({left:p});k._setArrowVisibility();if(d.isFunction(o.onRedraw)){o.onRedraw(n,j,o);}},100);});}else{j.unitWidth=o.unitWidth;}}},_dragEvents:function(){var m=this,q=this.options,i=this.internal,g=d(this.element).find(q.target),p=g.parent(),n=g,o=new Hammer(p.get(0),{drag:true,drag_vertical:false,drag_horizontal:true,drag_min_distance:0,transform:false,tap:false,tap_double:false,hold:false}),j=new this.wait(),f={},h={},l={};var k=function(){return{top:parseInt(n.css("top"),10),left:parseInt(n.css("left"),10)};};o.ondragstart=function(){if(true===i.isArrowBeingClicked||true===b){return{};}b=true;f=k();f.time=new Date().getTime();h={width:i.targetParentOuterWidth,height:i.targetParentOuterHeight};l={width:i.targetOuterWidth,height:i.targetOuterHeight};};o.ondrag=function(r){if(true===i.isArrowBeingClicked){return;}var t=1,s;if(r.direction==="up"||r.direction==="left"){r.distance=0-r.distance;}s=f.left+r.distance*t;i.left=s;n.css("left",s);};o.ondragend=function(r){g.stop(true,false);m._animate(g,{left:m.computeAdjust(g)},400,function(){console.log("animate dragend");m._setArrowVisibility();b=false;});};},_initAnimate:function(){var f=this.options;},_create:function(){var h=this.options,g=this.internal,i=d(this.element),f=d(this.element).find(h.target);this.internal.targetBackupCopy=this.element;if(this.options.cssAnimations){this.internal.prefix=this._getPrefix("transition");}f.css({position:"relative",left:0});if(h.dragEvents===true){this._dragEvents();}this._setArrowEvents();this._setUnitWidth();this._setTargetWidth("first load");this._setArrowVisibility();if(d.isFunction(h.onRedraw)){h.onRedraw(i,g,h);}},redraw:function(){var i=this,f=this.internal,g=this.options,h=d(this.element);this._setUnitWidth();this._setTargetWidth("_redraw");this._setArrowVisibility();if(d.isFunction(this.options.onRedraw)){i.options.onRedraw(h,f,g);}},destroy:function(){d(c).unbind(".simpslide");d(this.element).find(this.options.arrowLeft).unbind(".simpslide");d(this.element).find(this.options.arrowRight).unbind(".simpslide");this.element=this.internal.targetBackupCopy;d.Widget.prototype.destroy.call(this);},computeAdjust:function(f){var k,h,g,l,i,j;i=this.internal.targetParentInnerWidth;k=f.position().left;h=k+this.internal.targetWidth;l=this.internal.unitWidth/-2;if(h<i){j=k+i-h;k=j;}if(k>0){k=j=0;}g=k%this.internal.unitWidth;if(g!==0){if(g<l){j=k-(this.internal.unitWidth+g);}if(g>l){j=f.position().left-g;}}return j;}});})(jQuery,window,document);