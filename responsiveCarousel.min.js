/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed.
 *
 * This is a jQuery UI Widget
 *
 * @version 0.3.0
 * @releaseDate 9/6/2012
 * @author Matthew Toledo
 * @url https://github.com/mrbinky3000/responsive_carousel
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test, touch test optional), hammer.js
 */
(function(d,c,a){var b=false;d.widget("ri.responsiveCarousel",{options:{arrowLeft:".arrow-left a",arrowRight:".arrow-right a",target:".slider-target",mask:".slider-mask",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,dragEvents:false,speed:400,slideSpeed:2500,step:-1,responsiveStep:null,onShift:null,cssAnimations:Modernizr.csstransitions,nudgeThreshold:10},internal:{currentSlide:0,left:0,targetWidth:0,unitWidth:0,targetOuterWidth:0,targetOuterHeight:0,targetParentOuterWidth:0,targetParentInnerWidth:0,targetParentOuterHeight:0,targetParentMarginLeft:0,targetBackupCopy:null,isArrowBeingClicked:false,arrowLeftVisible:true,arrowRightVisible:true,targetLeft:0,timer:null,firstMouseClick:false,prefix:null,slideShowActive:false,slideTimer:null,slideBumped:false,nudgeDirection:null},wait:function(){var f,e=function(h,g){if("undefined"!==typeof f){c.clearTimeout(f);}f=c.setTimeout(h,g);};return{thenDo:function(h,g){e(h,g);}};},_getPrefix:function(j){var i=["Moz","Webkit","Khtml","0","ms"],h=a.createElement("div"),g=j.charAt(0).toUpperCase()+j.slice(1),f="",e=i.length;while(e>-1){if(h.style.hasOwnProperty(i[e]+g)){f=(i[e]);}e=e-1;}if(h.style.hasOwnProperty(j)){f=(j);}return"-"+f.toLowerCase()+"-";},_animate:function(e,h,i,j){var g=this.options,f=this.internal;return e.each(function(){var l=d(this),k=(f.prefix);if(g.cssAnimations){l.css(k+"transition","all "+i/1000+"s ease-in-out").css(h);c.setTimeout(function(){l.css(k+"transition","");if(d.isFunction(j)){j();}},i);}else{l.animate(h,i,function(){if(d.isFunction(j)){j();}});}});},_setTargetWidth:function(h){var f=this.internal,g=this.options,i=d(this.element),e=d(this.element).find(g.target);h=" "+h;f.targetWidth=e.find(g.unitElement).length*f.unitWidth;i.find(g.target).width(f.targetWidth);f.targetOuterWidth=e.outerWidth();f.targetOuterHeight=e.outerHeight();f.targetParentOuterWidth=e.parent().outerWidth();f.targetParentInnerWidth=e.parent().innerWidth();f.targetParentOuterHeight=e.parent().outerHeight();f.targetParentMarginLeft=parseInt(e.parents().css("marginLeft"),10);if(isNaN(f.targetParentMarginLeft)){f.targetParentMarginLeft=0;}},_setArrowVisibility:function(){var m=this.options,g=this.internal,f=d(this.element).find(m.target),e=f.position().left,l=g.targetOuterWidth+e,i=d(this.element).find(m.arrowLeft),k=d(this.element).find(m.arrowRight),j=0,h=g.targetParentOuterWidth;if(l<=h){k.hide();if(g.isArrowBeingClicked===true){this._clearInterval();}g.arrowRightVisible=g.isArrowBeingClicked=false;}else{if(false===g.arrowRightVisible){k.show();g.arrowRightVisible=true;}}if(e>=j){i.hide();if(g.isArrowBeingClicked===true){this._clearInterval();}g.arrowLeftVisible=g.isArrowBeingClicked=false;}else{if(false===g.arrowLeftVisible){i.show();g.arrowLeftVisible=true;}}g.currentSlide=d(f.find(m.unitElement)[Math.abs(e/g.unitWidth)]).data("slide");if(d.isFunction(m.onShift)){m.onShift(g.currentSlide);}},_clearInterval:function(){var f=this.internal,g=this.options,e=d(this.element).find(g.target);if("number"===typeof f.timer){f.isArrowBeingClicked=false;c.clearInterval(f.timer);}if(false===b){b=true;this._animate(e,{left:this.computeAdjust(e)},g.speed,function(){b=false;});}},_doArrowBeingClicked:function(k){var j=this,f=this.internal,h=this.options,e=d(this.element).find(h.target),g=e.position().left,l=f.targetParentMarginLeft,i;if(b===true){return;}if(k==="left"){i=g-l+f.unitWidth;}else{if(k==="right"){i=g-l-f.unitWidth;}else{throw new Error("unknown direction");}}b=true;this._animate(e,{left:i},h.speed,function(){j._setArrowVisibility();b=false;});},_setArrowEvents:function(){var k=this,i=this.options,g=this.internal,j=d(this.element).find(i.arrowLeft),e=d(this.element).find(i.arrowRight),f="",h="";j.on("click.responsiveCarousel",function(l){l.preventDefault();});e.on("click.responsiveCarousel",function(l){l.preventDefault();});if(i.dragEvents===true){f="mousedown.responsiveCarousel touchstart.responsiveCarousel";h="mouseup.responsiveCarousel touchend.responsiveCarousel";}else{f="mousedown.responsiveCarousel";h="mouseup.responsiveCarousel";}j.on(f,function(l){l.preventDefault();if(b===false){g.isArrowBeingClicked=g.firstMouseClick=true;g.timer=c.setInterval(function(){k._doArrowBeingClicked("left");},10);if(g.slideTimer){c.clearInterval(g.slideTimer);g.slideShowActive=false;}}});e.on(f,function(){if(b===false){g.isArrowBeingClicked=g.firstMouseClick=true;g.timer=c.setInterval(function(){k._doArrowBeingClicked("right");},10);if(g.slideTimer){c.clearInterval(g.slideTimer);g.slideShowActive=false;}}});d(this.element).on(h,function(){if(g.isArrowBeingClicked===true){k._clearInterval();}});},_setUnitWidth:function(){var l,g,j=this,i=this.internal,p=this.options,e=d(this.element).find(p.target),o=d(this.element),f=e.find(p.unitElement).eq(0),h=new this.wait(),k=function(){i.unitWidth=f.outerWidth();},n=function(){var m=o.find(p.mask).innerWidth();g=p.responsiveUnitSize(o,i,p);if("number"!==typeof g||g<1){throw new Error("The responsiveUnitSize callback must return a whole number greater than 0");}l=m/g;l=Math.floor(l);e.find(p.unitElement).css("width",l);i.unitWidth=l;};if(p.unitWidth==="inherit"){k();e.find("img").on("load.responsiveCarousel",function(){k();j._setTargetWidth("inherit");j._setArrowVisibility();if(d.isFunction(p.onRedraw)){p.onRedraw(o,i,p);}});}else{if(p.unitWidth==="compute"){k();if(d.isFunction(p.responsiveUnitSize)){n();k();}if(d.isFunction(p.onRedraw)){p.onRedraw(o,i,p);}e.find("img").on("load",function(){if(d.isFunction(p.responsiveUnitSize)){n();}k();j._setTargetWidth("compute");j._setArrowVisibility();if(d.isFunction(p.onRedraw)){p.onRedraw(o,i,p);}});d(c).on("resize.responsiveCarousel",function(){h.thenDo(function(){var m;if(d.isFunction(p.responsiveUnitSize)){n();}k();j._setTargetWidth("compute (window resize)");m=i.currentSlide*-1*i.unitWidth;e.css({left:m});j._setArrowVisibility();if(d.isFunction(p.onRedraw)){p.onRedraw(o,i,p);}},100);});}else{i.unitWidth=p.unitWidth;}}},_dragEvents:function(){var k=this,o=this.options,h=this.internal,f=d(this.element).find(o.target),n=f.parent(),l=f,m=new Hammer(n.get(0),{drag:true,drag_vertical:false,drag_horizontal:true,drag_min_distance:0,transform:false,tap:false,tap_double:false,hold:false}),e={},g={},j={},i=function(){return{top:parseInt(l.css("top"),10),left:parseInt(l.css("left"),10)};};m.ondragstart=function(){if(true===h.isArrowBeingClicked||true===b){return{};}b=true;e=i();e.time=new Date().getTime();g={width:h.targetParentOuterWidth,height:h.targetParentOuterHeight};j={width:h.targetOuterWidth,height:h.targetOuterHeight};};m.ondrag=function(p){if(true===h.isArrowBeingClicked){return;}var r=1,q;h.nudgeDirection=null;if(p.direction==="up"||p.direction==="left"){p.distance=-p.distance;if(Math.abs(p.distance)>o.nudgeThreshold&&Math.abs(p.distance)<h.unitWidth/2){h.nudgeDirection="left";}}else{if(p.distance>o.nudgeThreshold&&p.distance<h.unitWidth/2){h.nudgeDirection="right";}}q=e.left+p.distance*r;h.left=q;l.css("left",q);};m.ondragend=function(){f.stop(true,false);k._animate(f,{left:k.computeAdjust(f)},o.speed,function(){k._setArrowVisibility();b=false;});};},_create:function(){var g=this.options,f=this.internal,h=d(this.element),e=d(this.element).find(g.target);this.internal.targetBackupCopy=this.element;if(this.options.cssAnimations){this.internal.prefix=this._getPrefix("transition");}e.css({position:"relative",left:0});e.find(g.unitElement).each(function(j){d(this).attr({"data-slide":j});});if(g.dragEvents===true){this._dragEvents();}this._setArrowEvents();this._setUnitWidth();this._setTargetWidth("first load");this._setArrowVisibility();if(d.isFunction(g.onRedraw)){g.onRedraw(h,f,g);}},redraw:function(){var h=this,e=this.internal,f=this.options,g=d(this.element);this._setUnitWidth();this._setTargetWidth("_redraw");this._setArrowVisibility();if(d.isFunction(this.options.onRedraw)){h.options.onRedraw(g,e,f);}},getCurrentSlide:function(){return this.internal.currentSlide;},goToSlide:function(h){var k=this,f=this.internal,g=this.options,e=d(this.element).find(g.target),j;this._setUnitWidth();j=h*f.unitWidth*-1;b=true;this._animate(e,{left:j},g.speed,function(){b=false;k._setArrowVisibility();});},toggleSlideShow:function(){var i=this,f=this.internal,g=this.options,e=d(this.element).find(g.target),j=function(){if(true===f.slideShowActive){f.slideShowActive=false;c.clearInterval(f.slideTimer);}},h=function(m){var o=f.targetParentInnerWidth,q=e.position().left,l=q+f.targetWidth,p=q+m*f.unitWidth,n=l+m*f.unitWidth,k=p;if(f.slideBumped===false){if(n<=o){k=p+o-n;f.slideBumped="left";}if(p>=0){f.slideBumped="right";k=0;}}else{if("left"===f.slideBumped){k=0;}if("right"===f.slideBumped){k=q+o-l;}f.slideBumped=false;}b=true;i._animate(e,{left:k},g.speed,function(){b=false;i._setArrowVisibility();});};if(false===f.slideShowActive){f.slideShowActive=true;f.slideTimer=c.setInterval(function(){h(g.step);},g.slideSpeed);}else{j();}},destroy:function(){d(c).unbind(".responsiveCarousel");d(this.element).find(this.options.arrowLeft).unbind(".responsiveCarousel");d(this.element).find(this.options.arrowRight).unbind(".responsiveCarousel");this.element=this.internal.targetBackupCopy;d.Widget.prototype.destroy.call(this);},computeAdjust:function(f){var j=this.internal,i=f.position().left,n=i+j.targetWidth,k,g=j.unitWidth/-2,e=j.targetParentInnerWidth,m,l=j.nudgeDirection,h=j.unitWidth;if(l!==null){if(l==="left"){m=i-h;}if(l==="right"){m=i+h;}i=m;}if(n<e){m=i+e-n;i=m;}if(i>0){i=m=0;}k=i%this.internal.unitWidth;if(k!==0){if(k<g){m=i-(this.internal.unitWidth+k);}if(k>g){m=i-k;}}return m;}});}(jQuery,window,document));
